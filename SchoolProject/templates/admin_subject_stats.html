{% extends 'layout/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-body">
            <!-- Form chọn thông tin -->
            <form method="get" class="mb-4" id="statsForm">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label">Môn:</label>
                        <select name="subject" class="form-select" onchange="this.form.submit()">
                            <option value="Toán" {% if subject == 'Toán' %}selected{% endif %}>Toán</option>
                            <option value="Văn" {% if subject == 'Văn' %}selected{% endif %}>Văn</option>
                            <option value="Anh" {% if subject == 'Anh' %}selected{% endif %}>Anh</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Học kỳ:</label>
                        <select name="semester" class="form-select" onchange="this.form.submit()">
                            <option value="1" {% if semester == 1 %}selected{% endif %}>1</option>
                            <option value="2" {% if semester == 2 %}selected{% endif %}>2</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Năm học:</label>
                        <select name="year" class="form-select" onchange="this.form.submit()">
                            <option value="{{ prev_year_str }}" {% if year == prev_year_str %}selected{% endif %}>{{ prev_year_str }}</option>
                            <option value="{{ current_year_str }}" {% if year == current_year_str %}selected{% endif %}>{{ current_year_str }}</option>
                        </select>
                    </div>
                </div>
            </form>

            <!-- Báo cáo -->
            <div class="mt-4">
                <h4 class="text-center mb-4">BÁO CÁO TỔNG KẾT MÔN HỌC</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tr>
                            <td><strong>Môn:</strong> {{ subject }}</td>
                            <td><strong>Học kỳ:</strong> {{ semester }}</td>
                        </tr>
                        <tr>
                            <td colspan="2"><strong>Năm học:</strong> {{ year }}</td>
                        </tr>
                    </table>

                    <table class="table table-bordered mt-3">
                        <thead>
                            <tr class="text-center">
                                <th style="width: 50px">STT</th>
                                <th>Lớp</th>
                                <th>Sĩ số</th>
                                <th>Số lượng đạt</th>
                                <th>Tỷ lệ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in class_stats %}
                            <tr class="text-center">
                                <td>{{ loop.index }}</td>
                                <td>{{ stat.class_name }}</td>
                                <td>{{ stat.total_students }}</td>
                                <td>{{ stat.passing_students }}</td>
                                <td>{{ "%.2f"|format(stat.passing_rate) }}%</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('statsForm');
    const selects = form.querySelectorAll('select');
    
    selects.forEach(select => {
        select.addEventListener('change', function() {
            form.submit();
        });
    });
});
</script>
{% endblock %} 