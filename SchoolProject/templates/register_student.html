{%extends 'layout/base.html'%}

{%block title%}Trang đăng ký{%endblock%}

{%block content%}

<h1 class="text-info text-center">TRANG ĐĂNG KÝ</h1>
{%if err_msg%}
<div class="alert alert-danger">{{err_msg}}</div>
{%endif%}
<form method="post" action="/registerstudent" enctype="multipart/form-data">
    <div class="form-floating mb-3 mt-3">
        <input type="text" class="form-control" id="name" placeholder="Nhập tên học sinh" name="name" required>
        <label for="name">Họ tên</label>
    </div>
    <div class="form-floating mt-3 mb-3">
        <input type="file" class="form-control" id="avatar" name="avatar">
        <label for="avatar">Ảnh đại diện</label>
    </div>

    <div class="form-floating mt-3 mb-3">
        <input type="date" class="form-control" id="birthday" name="birthday">
        <label for="birthday">Ngày sinh</label>
    </div>

    <div class="form-floating mt-3 mb-3">
        <label for="gender">Giới tính</label>
        <select name="gender" id="gender">
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
        </select>
    </div>

    <div class="form-floating mt-3 mb-3">
        <input type="text" class="form-control" id="address" name="address">
        <label for="address">Địa chỉ</label>
    </div>

    <div class="form-floating mt-3 mb-3">
        <input type="text" class="form-control" id="phone" name="phone">
        <label for="phone">Số điện thoại</label>
    </div>

    <div class="form-floating mt-3 mb-3">
        <input type="text" class="form-control" id="email" name="email">
        <label for="email">Email</label>
    </div>

    <select id="grade_id">
        <option value="">-- Chọn khối --</option>
        {% for g in grades %}
        <option value="{{ g.id }}">{{ g.name }}</option>
        {% endfor %}
    </select>

    <select name="class_id" id="class_id">
        <option value="">-- Chọn lớp --</option>
    </select>

    <div class="form-floating mt-3 mb-3">
        <button type="submit" class="btn btn-success">Đăng ký học sinh</button>
    </div>

</form>


<script>
    {% if success_msg %}
        alert("{{ success_msg }}");
    {% endif %}
{% raw %}
    document.getElementById("grade_id").addEventListener("change", function () {
        let gradeId = this.value;
        let classSelect = document.getElementById("class_id");

        classSelect.innerHTML = '<option value="">-- Chọn lớp --</option>';

        if (gradeId) {
            fetch(`/get-classes?grade_id=${gradeId}`)
                .then(response => response.json())
                .then(data => {
                    for (let cls of data) {
                        let option = document.createElement("option");
                        option.value = cls.id;
                        option.textContent = cls.name;
                        classSelect.appendChild(option);
                    }
                });
        }
    });
</script>
{% endraw %}
{%endblock%}
